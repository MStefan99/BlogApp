"use strict";function _classCallCheck(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(d,b){for(var a=0;a<b.length;a++){var c=b[a];c.enumerable=c.enumerable||false;c.configurable=true;if("value" in c){c.writable=true}Object.defineProperty(d,c.key,c)}}function _createClass(c,a,b){if(a){_defineProperties(c.prototype,a)}if(b){_defineProperties(c,b)}return c}var form=function(){function b(n){_classCallCheck(this,b);this.form_element=void 0;this.email_ok=true;this.email_match_ok=true;this.login_ok=true;this.username_ok=true;this.new_password_ok=true;this.new_password_match_ok=true;this.required_ok=true;this.form_element=n}_createClass(b,[{key:"enable_smart_submit",value:function c(){var n=this;if(this.submit){this.submit.addEventListener("click",function(o){o.preventDefault();n.submit.classList.add("disabled");if(n.validate_all()){n.form_element.submit()}});b.onkeypress=function(p){var o=p.key;if(o==="Enter"){p.preventDefault();n.submit.classList.add("disabled");if(n.validate_all()){n.form_element.submit()}}}}}},{key:"setup",value:function d(){var n=this;this.email=this.form_element.querySelector("input.email");this.repeat_email=this.form_element.querySelector("input.repeat-email");this.username=this.form_element.querySelector("input.username");this.login=this.form_element.querySelector("input.login");this.new_password=this.form_element.querySelector("input.new-password");this.repeat_new_password=this.form_element.querySelector("input.repeat-new-password");this.required=this.form_element.querySelectorAll("input[required]");this.submit=this.form_element.querySelector("button");this.login_msg=this.form_element.querySelector("p.login-check");this.email_msg=this.form_element.querySelector("p.email-check");this.repeat_email_msg=this.form_element.querySelector("p.email-match-check");this.username_msg=this.form_element.querySelector("p.username-check");this.new_password_msg=this.form_element.querySelector("p.new-password-check");this.repeat_new_password_msg=this.form_element.querySelector("p.repeat-new-password-check");this.required_msg=this.form_element.querySelector("p.required-check");if(this.email){if(this.email.classList.contains("realtime-validate")){["keyup","paste","load"].forEach(function(o){n.email.addEventListener(o,function(){n.check_email(n.email,n.email_msg)});if(n.repeat_email){n.email.addEventListener(o,function(){n.check_email_match(n.email,n.repeat_email,n.repeat_email_msg)})}})}}else{console.log("No email field, continuing...")}if(this.repeat_email){if(this.repeat_email.classList.contains("realtime-validate")){["keyup","paste","load"].forEach(function(o){n.repeat_email.addEventListener(o,function(){n.check_email_match(n.email,n.repeat_email,n.repeat_email_msg)})})}}else{console.log("No email-repeat field, continuing...")}if(this.username){if(this.username.classList.contains("realtime-validate")){["keyup","paste","load"].forEach(function(o){n.username.addEventListener(o,function(){n.check_username(n.username,n.username_msg)})})}}else{console.log("No username field, continuing...")}if(this.login){if(this.login.classList.contains("realtime-validate")){["keyup","paste","load"].forEach(function(o){n.login.addEventListener(o,function(){n.check_login(n.login,n.login_msg)})})}}else{console.log("No login field, continuing...")}if(this.new_password){if(this.new_password.classList.contains("realtime-validate")){["keyup","paste","load"].forEach(function(o){n.new_password.addEventListener(o,function(){n.check_password(n.new_password,n.new_password_msg);n.check_password_match(n.new_password,n.repeat_new_password,n.repeat_new_password_msg)})})}}else{console.log("No new-password field, continuing...")}if(this.repeat_new_password){if(this.repeat_new_password.classList.contains("realtime-validate")){["keyup","paste","load"].forEach(function(o){n.repeat_new_password.addEventListener(o,function(){n.check_password_match(n.new_password,n.repeat_new_password,n.repeat_new_password_msg)})})}}else{console.log("No repeat-new-password field, continuing...")}this.enable_smart_submit()}},{key:"check_username",value:function f(s,q){var p=this;var o=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;s.value=s.value.trim().replace(/\s+/g,"");if(!s.value.trim()){q.innerHTML="";this.username_ok=!s.hasAttribute("required")}else{var n=/^(?=.*[a-zA-Z]+)[0-9a-zA-Z\-_.]{3,100}$/;this.username_ok=n.test(s.value.toLowerCase());if(!this.username_ok){q.className="credentials-check error";q.innerHTML='Your username must be at least 3 symbols long and include only letters, numbers or characters "-", "_" and ".". Spaces not allowed.'}else{var r=new XMLHttpRequest();r.onreadystatechange=function(){if(r.readyState===4&&r.status===200){var t=r.responseText;switch(t){case"OK":q.className="credentials-check ok";q.innerHTML="Username is free";break;case"ALREADY EXISTS":q.className="credentials-check error";q.innerHTML="Username is already taken!";break;default:q.innerHTML=""}p.username_ok=t==="OK";p.validate_form();b.set_color(p.username_ok,s)}};r.open("POST","/check_username/",o);r.setRequestHeader("Content-type","application/x-www-form-urlencoded");r.send("username="+s.value)}}this.validate_form();b.set_color(this.username_ok,s)}},{key:"check_login",value:function k(n,q){var o=this;var p=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;n.value=n.value.trim().replace(/\s+/g,"");if(!n.value.trim()){q.innerHTML="";this.login_ok=!n.hasAttribute("required")}else{var r=new XMLHttpRequest();r.onreadystatechange=function(){if(r.readyState===4&&r.status===200){var s=r.responseText;switch(s){case"OK":q.className="credentials-check ok";q.innerHTML="User found";break;case"NOT FOUND":q.className="credentials-check error";q.innerHTML="User not found!";break;default:q.innerHTML=""}o.login_ok=s==="OK";o.validate_form();b.set_color(o.login_ok,n)}};r.open("POST","/check_login/",p);r.setRequestHeader("Content-type","application/x-www-form-urlencoded");r.send("login="+n.value)}this.validate_form();b.set_color(this.login_ok,n)}},{key:"check_email",value:function h(p,o){var n=this;var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;p.value=p.value.trim().replace(/\s+/g,"");if(!p.value){o.innerHTML="";this.email_ok=!p.hasAttribute("required")}else{var q=/^(([^<>()\[\]\\.,;:\s@"][\w]+(\.[^<>()\[\]\\.,;:\s@"][\w]+)*)|("\w+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;this.email_ok=q.test(p.value.toLowerCase());if(!this.email_ok){o.className="credentials-check error";o.innerHTML="Invalid email format"}else{var s=new XMLHttpRequest();s.onreadystatechange=function(){if(s.readyState===4&&s.status===200){var t=s.responseText;switch(t){case"OK":o.className="credentials-check ok";o.innerHTML="Email is free";break;case"ALREADY EXISTS":o.className="credentials-check error";o.innerHTML="Email is already taken!";break;default:o.innerHTML=""}n.email_ok=t==="OK";n.validate_form();b.set_color(n.email_ok,p)}};s.open("POST","/check_email/",r);s.setRequestHeader("Content-type","application/x-www-form-urlencoded");s.send("email="+p.value)}}this.validate_form();b.set_color(this.email_ok,p)}},{key:"check_email_match",value:function l(o,p,n){if(!o.value&&o.hasAttribute("required")&&!p.value&&p.hasAttribute("required")){this.email_match_ok=false}else{if(o.value!==p.value){n.innerHTML="Emails do not match";n.className="credentials-check error";this.email_match_ok=false}else{n.innerHTML="";this.email_match_ok=true}}this.validate_form();b.set_color(this.email_match_ok,o,p)}},{key:"check_password",value:function m(n,q){var p=/^(?=.*[a-zA-Z]+)(?=.*[0-9]+)[0-9a-zA-Z!@#$%^&*(){}\[\]\-_=+,.<>|\\]{8,100}$/;var o=p.test(n.value.toLowerCase());if(!o){q.className="credentials-check error";q.innerHTML="Your password must be at least 8 characters long and include at least one letter and one number. Spaces not allowed."}else{q.innerHTML=""}this.new_password_ok=o;this.validate_form();b.set_color(this.new_password_ok,n)}},{key:"check_password_match",value:function i(n,p,o){if(!n.value&&n.hasAttribute("required")&&!p.value&&p.hasAttribute("required")){o.innerHTML="";this.new_password_match_ok=false}else{if(!n.value.trim()&&!p.value.trim()){o.innerHTML=""}else{if(n.value!==p.value){o.innerHTML="Passwords do not match";o.className="credentials-check error";this.new_password_match_ok=false}else{if(n.value===p.value){o.innerHTML="Passwords match";o.className="credentials-check ok";this.new_password_match_ok=true}}}}this.validate_form();b.set_color(this.new_password_ok,n);b.set_color(this.new_password_match_ok,p)}},{key:"check_required",value:function j(o){var n=this;this.required_ok=true;if(this.required_msg){o.innerHTML=""}Array.from(this.required).forEach(function(p){if(!p.value){n.required_ok=false;o.innerHTML="Please fill in all required fields";o.className="credentials-check error";b.set_color(n.required_ok,p)}});this.validate_form()}},{key:"validate_all",value:function e(){if(this.username){this.check_username(this.username,this.username_msg,false)}if(this.login){this.check_login(this.login,this.login_msg,false)}if(this.email){this.check_email(this.email,this.email_msg,false)}if(this.repeat_email){this.check_email_match(this.email,this.repeat_email,this.repeat_email_msg)}if(this.new_password){this.check_password(this.new_password,this.new_password_msg)}if(this.new_password&&this.repeat_new_password){this.check_password_match(this.new_password,this.repeat_new_password,this.repeat_new_password_msg)}if(this.required){this.check_required(this.required_msg)}var n=this.email_ok&&this.email_match_ok&&this.username_ok&&this.login_ok&&this.new_password_match_ok&&this.required_ok;if(!n){this.submit.classList.add("disabled")}else{this.submit.classList.remove("disabled")}return n}},{key:"validate_form",value:function g(){if(this.email_ok&&this.email_match_ok&&this.username_ok&&this.login_ok&&this.new_password_match_ok&&this.required_ok){this.submit.classList.remove("disabled");return false}else{this.submit.classList.add("disabled");return true}}}],[{key:"set_color",value:function a(o){for(var n=arguments.length,q=new Array(n>1?n-1:0),p=1;p<n;p++){q[p-1]=arguments[p]}q.forEach(function(r){if(!r.value){r.style.borderColor="var(--accent-color)"}else{if(o){r.style.borderColor="var(--ok)"}else{r.style.borderColor="var(--error)"}}})}}]);return b}();var forms=document.getElementsByClassName("validated");Array.from(forms).forEach(function(a){a=new form(a);a.setup()});